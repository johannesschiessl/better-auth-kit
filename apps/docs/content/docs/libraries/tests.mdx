---
title: "@better-auth-kit/tests"
description: A collection of utilities to help you test your Better-Auth plugins.
---

<GithubButton url="https://github.com/ping-maxwell/better-auth-kit/tree/main/packages/libraries/tests" />
<NpmButton url="https://www.npmjs.com/package/@better-auth-kit/tests" />

If you're developing a custom plugin for Better-Auth, you may need to test it. This library is intended to provide utilities to help you test your plugins.

<Callout type="info">
This library currently is pulled out from the main Better-Auth package, but is intended to provide more features in the future.
</Callout>


<Steps>
<Step>

## Installation

```package-install
@better-auth-kit/tests
```

</Step>
<Step>

## Usage

```ts title="my-plugin.test.ts"
import { getTestInstance } from "@better-auth-kit/tests";
import { describe, expect, it, vi } from "vitest";
import { myPlugin, myClientPlugin } from "./my-plugin.ts";

const { auth, db, client, testUser, signInWithTestUser } = await getTestInstance(
	{
		plugins: [myPlugin()],
	},
	{
		clientOptions: {
			plugins: [myClientPlugin()],
		},
	},
);


// Your test user is already created
const { headers, user } = await signInWithTestUser();

describe("My Plugin", () => {
	it("should do something cool", async () => {
		const result = await client.myPlugin.doSomethingCool();
        
		expect(result).toBe(true);
	});
});
```
</Step>

<Step>

## Initialize a postgres instance

<Callout>
If you've selected the `mysql` database option, you will have to initialize a mysql instance instead.
</Callout>

Copy the following docker compose file into your test directory.

```yml title="docker-compose.yml"
version: '3.8'

services:
  postgres:
    image: postgres:latest
    container_name: postgres_db
    environment:
      POSTGRES_USER: user
      POSTGRES_PASSWORD: password
      POSTGRES_DB: better_auth
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data: 
```

Then run this command to start the postgres instance.

```bash
docker compose up
```

</Step>

<Step>

## Begin testing!

Make sure that your test database instance is running, and then you can begin testing!

```bash
vitest foobar
```

</Step>

</Steps>

<div className="h-10" />

# API

## `getTestInstance`

Optionally takes two arguments, the first is the options for the `betterAuth` instance, the second is the options for the test instance itself.

You can configure the betterAuth client instance inside the second argument.

```ts
const {
	auth,
	db,
	client,
	testUser,
	signInWithTestUser,
	signInWithUser,
	cookieSetter,
	customFetchImpl,
	sessionSetter,
}  = await getTestInstance(
	{
        // Better-Auth options
		plugins: [myPlugin()],
	},
	{
		clientOptions: {
            // Client options
			plugins: [myClientPlugin()],
		},
	},
);
```

### Options

- `clientOptions` - The options for the Better-Auth client instance.
- `port` - The baseURL port for the better-auth instance.
- `disableTestUser` - Whether to disable the test user.
- `testUser` - The test user to use for the test instance.
- `testWith` - The database to use for the test instance. (`sqlite`, `postgres`, `mongodb`, `mysql`)

### Methods

- `auth` - The Better-Auth instance.
- `client` - The Better-Auth client instance.
- `testUser` - The premade test user.
- `signInWithTestUser` - Sign in with the premade test user.
- `signInWithUser` - Sign in with a custom user.
- `cookieSetter` - Set the cookie for the test instance.
- `customFetchImpl` - The custom fetch implementation for the test instance.
- `sessionSetter` - Set the session for the test instance.

---

#### `auth`

The Better-Auth instance.

#### `client`

The Better-Auth client instance.

#### `testUser`

The premade test user.

#### `signInWithTestUser`

```ts
const { headers, user } = await signInWithTestUser();
```

#### `signInWithUser`

```ts
const { headers, user } = await signInWithUser(email, password);
```

#### `cookieSetter`

Useful for getting the session of a successful sign in and applying that to a new headers object's cookie.

```ts
const headers = new Headers();
await client.signIn.email(
    {
        email: testUser.email,
        password: testUser.password,
    },
    {
        onSuccess: cookieSetter(headers),
    },
);
```

#### `customFetchImpl`

By default, when using the auth client, we make a fetch request to the better-auth server whenever you call an endpoint.
However, you can optionally provide the `customFetchImpl` to bypass this and it will skip the fetch request to the better-auth server, and instead directly invoke the endpoint on the server.

```ts
const client = createAuthClient({
	baseURL: "http://localhost:3000",
	fetchOptions: {
		customFetchImpl,
	},
});
```

#### `sessionSetter`

Useful for getting the session from the response of a successful sign in and applying that to a new headers object.

```ts
const headers = new Headers();
await client.signIn.email(
    {
        email: testUser.email,
        password: testUser.password,
    },
    {
        onSuccess: sessionSetter(headers),
    },
);

const response = await client.listSessions({
    fetchOptions: {
        headers,
    },
});
```

#### `db`

The database adapter.

```ts title="example"
await db.create({
	model: "sometable",
	data: {
		hello: "world"
	},
});
```


